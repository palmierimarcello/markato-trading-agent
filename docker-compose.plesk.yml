version: '3.8'

# Docker Compose per Plesk con PostgreSQL esterno
# Usa questo file invece di docker-compose.yml se hai PostgreSQL già installato su Plesk

services:
  # Trading Agent Application
  trading_agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: trading_agent_app
    restart: unless-stopped
    network_mode: "host"
    environment:
      # Database esterno Plesk
      DATABASE_URL: ${DATABASE_URL}

      # Hyperliquid
      PRIVATE_KEY: ${PRIVATE_KEY}
      WALLET_ADDRESS: ${WALLET_ADDRESS}

      # OpenAI
      OPENAI_API_KEY: ${OPENAI_API_KEY}

      # CoinMarketCap
      CMC_PRO_API_KEY: ${CMC_PRO_API_KEY}

      # Python
      PYTHONUNBUFFERED: 1
    volumes:
      - ./logs:/app/logs
      - ./account_status_old.json:/app/account_status_old.json
    # Nessuna dipendenza da postgres perché è esterno

  # API Web per monitoring
  web_api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: trading_agent_api
    restart: unless-stopped
    network_mode: "host"
    environment:
      DATABASE_URL: ${DATABASE_URL}
      API_PORT: ${API_PORT:-8000}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# NOTE:
# - Non c'è servizio postgres perché usa quello di Plesk
# - network_mode: host permette l'accesso a localhost:5432
# - Non servono volumi per postgres
# - Non serve network personalizzato
